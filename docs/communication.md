# Server-Client communication over TCP

Detecctor (the server) and Deteccted (the client) communicate
through [the TCP server library](https://github.com/Allenxuxu/gev) which is similar to WebSockets (two-way
communication).

## Payload struct

The messages sent to and from the server are in **JSON** format, encoded with **base64** encoding. The JSON object sent
to and from the client is the `Payload` struct.

The `Id` field is a UUID, generated by the server when a command is issued and processed by the server plugin. It maps
the `Payload` to the `ChatId` when the client responds and the server interprets the response.

The `ServiceNodeKey` attribute is used to identify the target client and to map the response of the client to a request.

The `Data` contains the data produced by server and client plugins.

The `Command` is used to find and execute the correlating plugin on the client and process the response with the same
plugin.

Both the `Success` and `Error` attributes are used for error handling in both client and server.

```go
package shared

type Payload struct {
	Id             string
	ServiceNodeKey string
	Data           interface{}
	Command        string
	Success        bool
	Error          string
}
```

### Creating a new Payload

When creating a `Payload` in the plugin, please use the provided Payload API.

```go
package example

import . "github.com/detecc/detecctor/shared"

func CreateNewPayload() {
	NewPayload(ForClient("sampleClientId"), WithData("sampleData"), Successful())
}
```